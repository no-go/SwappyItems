<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The SwappyItems Key-Values Store: osm2graph.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The SwappyItems Key-Values Store
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">osm2graph.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>This is a example, how to store osm street data into a graph structure. in the future I will do a Dijkstra with this data.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span> <span class="comment">// pair</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span> <span class="comment">// acos</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span> <span class="comment">// reverse</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SwappyItems_8hpp.html">SwappyItems.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="osmpbfreader_8hpp.html">osmpbfreader.hpp</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceCanalTP.html">CanalTP</a>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define FILE_ITEMS           (   2*1024) </span><span class="comment">// 2*1024  // 64*1024</span></div>
<div class="line"><span class="preprocessor">#define FILE_MULTI                    4  </span><span class="comment">// 4       // 16</span></div>
<div class="line"><span class="preprocessor">#define RAM_MULTI                     8  </span><span class="comment">// 8</span></div>
<div class="line"><span class="preprocessor">#define BBITS                         5  </span><span class="comment">// 5</span></div>
<div class="line"><span class="preprocessor">#define BMASK   ((BBITS+4)*  FILE_ITEMS) </span><span class="comment">// +4</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TORADI(angleDegrees) ((angleDegrees) * M_PI / 180.0)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// europa: lon  -10..25</span></div>
<div class="line"><span class="comment">//         lat   35..70</span></div>
<div class="line"><span class="comment">//#define LON_BOUND -10.0</span></div>
<div class="line"><span class="comment">//#define LON_BOUND_DIF 35.0</span></div>
<div class="line"><span class="comment">//#define LAT_BOUND 35.0</span></div>
<div class="line"><span class="comment">//#define LAT_BOUND_DIF 35.0</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// nrw:    lon   5.85..9.47   like x (0=London, 90=Bhutan)</span></div>
<div class="line"><span class="comment">//         lat  50.32..52.52  like y (0=Equartor, 90=Nothpole)</span></div>
<div class="line"><span class="preprocessor">#define LON_BOUND 5.85</span></div>
<div class="line"><span class="preprocessor">#define LON_BOUND_DIF 3.62</span></div>
<div class="line"><span class="preprocessor">#define LAT_BOUND 50.32</span></div>
<div class="line"><span class="preprocessor">#define LAT_BOUND_DIF 2.2</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// krefeld-mg</span></div>
<div class="line"><span class="comment">//#define LON_BOUND 6.4</span></div>
<div class="line"><span class="comment">//#define LON_BOUND_DIF 0.30</span></div>
<div class="line"><span class="comment">//#define LAT_BOUND 51.1</span></div>
<div class="line"><span class="comment">//#define LAT_BOUND_DIF 0.30</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//#define MAX_NODES 27672 // krefeld-mg result!</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEFAULTATTR &quot; version=&#39;1&#39; timestamp=&#39;2019-12-20T14:59:00Z&#39; visible=&#39;true&#39;&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> uint64_t <a name="a0"></a><a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a>; <span class="comment">// for the key-value tuple, 8 byte</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// --------------------------------------------------- OSM DATA</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// + id = osmid of a osm node</span></div>
<div class="line"><span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structNodeData.html">NodeData</a> {</div>
<div class="line">    uint8_t _used;</div>
<div class="line">    <span class="keywordtype">double</span> _lon;</div>
<div class="line">    <span class="keywordtype">double</span> _lat;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// + id = osmid of a osm way</span></div>
<div class="line"><span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structWayData.html">WayData</a> {</div>
<div class="line">    <span class="keywordtype">bool</span> _oneway; <span class="comment">// store refs in reverse order, if oneway is -1</span></div>
<div class="line">};</div>
<div class="line"><span class="comment">// + list of refs to osm nodes (path)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// --------------------------------------------------- RESULT DATA</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// + id = osmid of a osm node</span></div>
<div class="line"><span class="keyword">struct </span><a name="_a3"></a><a class="code" href="structVertex.html">Vertex</a> {</div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> _way; <span class="comment">// note: the first seen osmid of the way, where we see this node</span></div>
<div class="line">    <span class="keywordtype">double</span> _lon;</div>
<div class="line">    <span class="keywordtype">double</span> _lat;</div>
<div class="line">};</div>
<div class="line"><span class="comment">// + list of refs to other Vertex</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// + id = osmid of a osm node</span></div>
<div class="line"><span class="keyword">struct </span><a name="_a4"></a><a class="code" href="structDistance.html">Distance</a> {</div>
<div class="line">    uint8_t _dummy;</div>
<div class="line">};</div>
<div class="line"><span class="comment">// + list of refs to store distances</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <a name="_a5"></a><a class="code" href="classSwappyItems.html">SwappyItems&lt;Key, WayData, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK&gt;</a> <a name="a6"></a><a class="code" href="osm2graph_8cpp.html#a9c262dd362043bb970f05a87a0d749fa">Ways_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="classSwappyItems.html">SwappyItems&lt;Key, NodeData, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK&gt;</a> <a name="a7"></a><a class="code" href="osm2graph_8cpp.html#ac67c257267e24e52a63e063afa220484">Nodes_t</a>;</div>
<div class="line"><a class="code" href="classSwappyItems.html">Ways_t</a> * <a name="a8"></a><a class="code" href="osm2graph_8cpp.html#a0b1f512d3b235baf9b8949152f9d5b89">ways</a>;</div>
<div class="line"><a class="code" href="classSwappyItems.html">Nodes_t</a> * <a name="a9"></a><a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="classSwappyItems.html">SwappyItems&lt;Key, Vertex, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK&gt;</a> <a name="a10"></a><a class="code" href="osm2graph_8cpp.html#a1192e0b3b6e0a1997dc2a3e21be39ab4">Vertices_t</a>;</div>
<div class="line"><a class="code" href="classSwappyItems.html">Vertices_t</a> * <a name="a11"></a><a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>;</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="classSwappyItems.html">SwappyItems&lt;Key, Distance, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK&gt;</a> <a name="a12"></a><a class="code" href="osm2graph_8cpp.html#a3ea3507aa745cb1c0ff9772a098551d9">Distance_t</a>;</div>
<div class="line"><a class="code" href="classSwappyItems.html">Distance_t</a> * <a name="a13"></a><a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> <a name="a14"></a><a class="code" href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a>(<span class="keywordtype">double</span> lon1, <span class="keywordtype">double</span> lat1, <span class="keywordtype">double</span> lon2, <span class="keywordtype">double</span> lat2) {</div>
<div class="line">    <span class="keywordtype">double</span> dist = 6378388.0 * std::acos(std::sin(<a name="a15"></a><a class="code" href="osm2graph_8cpp.html#a2410a433659c2a453790dea3033603ff">TORADI</a>(lat1)) * std::sin(<a class="code" href="osm2graph_8cpp.html#a2410a433659c2a453790dea3033603ff">TORADI</a>(lat2)) + std::cos(<a class="code" href="osm2graph_8cpp.html#a2410a433659c2a453790dea3033603ff">TORADI</a>(lat1)) * std::cos(<a class="code" href="osm2graph_8cpp.html#a2410a433659c2a453790dea3033603ff">TORADI</a>(lat2)) * std::cos(<a class="code" href="osm2graph_8cpp.html#a2410a433659c2a453790dea3033603ff">TORADI</a>(lon2 - lon1)));</div>
<div class="line">    <span class="keywordflow">if</span> (dist &lt; 0) dist *=-1;</div>
<div class="line">    <span class="keywordflow">return</span> dist;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a name="a16"></a><a class="code" href="osm2graph_8cpp.html#a65edcf08ce03e2cd92d88fcb97c789e1">relevance</a>(<span class="keyword">const</span> std::string &amp; wt) {</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;motorway&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;motorway_link&quot;</span>) == 0) <span class="keywordflow">return</span> 2;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;trunk&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;trunk_link&quot;</span>) == 0) <span class="keywordflow">return</span> 2;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;primary&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;primary_link&quot;</span>) == 0) <span class="keywordflow">return</span> 2;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;secondary&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;secondary_link&quot;</span>) == 0) <span class="keywordflow">return</span> 2;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;unclassified&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;tertiary&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;tertiary_link&quot;</span>) == 0) <span class="keywordflow">return</span> 2;</div>
<div class="line">    <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;residential&quot;</span>) == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a name="_a17"></a><a class="code" href="structRouting.html">Routing</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> node_callback(uint64_t osmid, <span class="keywordtype">double</span> lon, <span class="keywordtype">double</span> lat, <span class="keyword">const</span> <a name="a18"></a><a class="code" href="namespaceCanalTP.html#a4f01523a1c3b0897ec8e357a68513217">Tags</a> &amp;<span class="comment">/*tags*/</span>) {</div>
<div class="line">        <span class="comment">// not valid pos</span></div>
<div class="line">        <span class="keywordflow">if</span> (lon == 0 &amp;&amp; lat == 0) <span class="keywordflow">return</span>;</div>
<div class="line">        <span class="keywordtype">double</span> checklon = lon - <a name="a19"></a><a class="code" href="osm2graph_8cpp.html#a55c3677d7a94dbe389e73f4e473c8b79">LON_BOUND</a>;</div>
<div class="line">        <span class="keywordtype">double</span> checklat = lat - <a name="a20"></a><a class="code" href="osm2graph_8cpp.html#a23d759ebd23b8b9cb9c63eea5cc83583">LAT_BOUND</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (checklon &gt; <a name="a21"></a><a class="code" href="osm2graph_8cpp.html#a25693d3ff18682aed1a5d004e1da24ba">LON_BOUND_DIF</a> || checklon &lt; 0.0) <span class="keywordflow">return</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (checklat &gt; <a name="a22"></a><a class="code" href="osm2graph_8cpp.html#afa99738263e8ba632668e483f87d6f1f">LAT_BOUND_DIF</a> || checklat &lt; 0.0) <span class="keywordflow">return</span>;</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Nodes_t::Data</a> * nodeptr = <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a name="a23"></a><a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(osmid);</div>
<div class="line">        <span class="comment">// not a node of my ways (I read node ids from ways first</span></div>
<div class="line">        <span class="keywordflow">if</span> (nodeptr == <span class="keyword">nullptr</span>) <span class="keywordflow">return</span>;</div>
<div class="line">        <span class="comment">// we only use nodes of connected ways? (ignore sackgasse and links in between -&gt; fail on distance!)</span></div>
<div class="line">        <span class="comment">//if (nodeptr-&gt;first._used == 0) return;</span></div>
<div class="line">        nodeptr-&gt;first._lon = lon;</div>
<div class="line">        nodeptr-&gt;first._lat = lat;</div>
<div class="line">        <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a name="a24"></a><a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(osmid, nodeptr-&gt;first);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> way_callback(uint64_t osmid, <span class="keyword">const</span> <a class="code" href="namespaceCanalTP.html#a4f01523a1c3b0897ec8e357a68513217">Tags</a> &amp;tags, <span class="keyword">const</span> std::vector&lt;uint64_t&gt; &amp;refs) {</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (tags.find(<span class="stringliteral">&quot;highway&quot;</span>) != tags.end()) {</div>
<div class="line">            <span class="keywordtype">int</span> wt = <a class="code" href="osm2graph_8cpp.html#a65edcf08ce03e2cd92d88fcb97c789e1">relevance</a>(tags.at(<span class="stringliteral">&quot;highway&quot;</span>));</div>
<div class="line">            <span class="keywordflow">if</span> (wt == 0) <span class="keywordflow">return</span>;</div>
<div class="line">            </div>
<div class="line">            std::vector&lt;Key&gt; path;</div>
<div class="line">            <a class="code" href="structWayData.html">WayData</a> way;</div>
<div class="line">            <span class="keywordtype">unsigned</span> pathlength = refs.size();</div>
<div class="line">            way.<a name="a25"></a><a class="code" href="structWayData.html#ae5ee62c1bbb934ecfa4932caf567cc55">_oneway</a> = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordtype">bool</span> rev = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordtype">bool</span> circle = <span class="keyword">false</span>;</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (wt == 2) way.<a class="code" href="structWayData.html#ae5ee62c1bbb934ecfa4932caf567cc55">_oneway</a> = <span class="keyword">true</span>; <span class="comment">// it is a link! oneway=yes is a default</span></div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (tags.find(<span class="stringliteral">&quot;oneway&quot;</span>) != tags.end()) {</div>
<div class="line">                std::string wt = tags.at(<span class="stringliteral">&quot;oneway&quot;</span>); <span class="comment">// yes, no, reversible, -1, ...</span></div>
<div class="line">                <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;yes&quot;</span>) == 0) way.<a class="code" href="structWayData.html#ae5ee62c1bbb934ecfa4932caf567cc55">_oneway</a> = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;no&quot;</span>) == 0) way.<a class="code" href="structWayData.html#ae5ee62c1bbb934ecfa4932caf567cc55">_oneway</a> = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (wt.compare(<span class="stringliteral">&quot;-1&quot;</span>) == 0) {</div>
<div class="line">                    way.<a class="code" href="structWayData.html#ae5ee62c1bbb934ecfa4932caf567cc55">_oneway</a> = <span class="keyword">true</span>;</div>
<div class="line">                    rev = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (pathlength&gt;1) {</div>
<div class="line">                <span class="keywordflow">if</span> (refs[0] == refs[pathlength-1]) circle = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Nodes_t::Data</a> * nodeptr;</div>
<div class="line">            <span class="keywordflow">if</span> (circle) {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=1; i &lt; pathlength; ++i) {</div>
<div class="line">                    nodeptr = <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(refs[i]);</div>
<div class="line">                    <span class="keywordflow">if</span> (nodeptr == <span class="keyword">nullptr</span>) {</div>
<div class="line">                        <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Nodes_t::Data</a> node;</div>
<div class="line">                        node.first._used = 0;</div>
<div class="line">                        node.first._lon = 0.0;</div>
<div class="line">                        node.first._lat = 0.0;</div>
<div class="line">                        <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(refs[i], node.first);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="comment">// node is also used in another way!</span></div>
<div class="line">                        nodeptr-&gt;first._used++;</div>
<div class="line">                        <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(refs[i], nodeptr-&gt;first);</div>
<div class="line">                    }</div>
<div class="line">                    path.push_back(refs[i]);</div>
<div class="line">                }</div>
<div class="line">                path.push_back(refs[1]); <span class="comment">// add the real firts node additionally to the end</span></div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i &lt; pathlength; ++i) {</div>
<div class="line">                    nodeptr = <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(refs[i]);</div>
<div class="line">                    <span class="keywordflow">if</span> (nodeptr == <span class="keyword">nullptr</span>) {</div>
<div class="line">                        <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Nodes_t::Data</a> node;</div>
<div class="line">                        node.first._used = 0;</div>
<div class="line">                        node.first._lon = 0.0;</div>
<div class="line">                        node.first._lat = 0.0;</div>
<div class="line">                        <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(refs[i], node.first);</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="comment">// node is also used in another way!</span></div>
<div class="line">                        nodeptr-&gt;first._used++;</div>
<div class="line">                        <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(refs[i], nodeptr-&gt;first);</div>
<div class="line">                    }</div>
<div class="line">                    path.push_back(refs[i]);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (rev) std::reverse(path.begin(), path.end());</div>
<div class="line">            <a class="code" href="osm2graph_8cpp.html#a0b1f512d3b235baf9b8949152f9d5b89">ways</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(osmid, way, path);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// today We don&#39;t care about relations</span></div>
<div class="line">    <span class="keywordtype">void</span> relation_callback(uint64_t <span class="comment">/*osmid*/</span>, <span class="keyword">const</span> <a class="code" href="namespaceCanalTP.html#a4f01523a1c3b0897ec8e357a68513217">Tags</a> &amp;<span class="comment">/*tags*/</span>, <span class="keyword">const</span> <a name="a26"></a><a class="code" href="namespaceCanalTP.html#a090d83d412eb66517a72e002e0c583a6">References</a> &amp; <span class="comment">/*refs*/</span>){}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a name="a27"></a><a class="code" href="osm2graph_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line">    <a class="code" href="structRouting.html">Routing</a> routing;</div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#a0b1f512d3b235baf9b8949152f9d5b89">ways</a> = <span class="keyword">new</span> <a class="code" href="osm2graph_8cpp.html#a9c262dd362043bb970f05a87a0d749fa">Ways_t</a>(1);</div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a> = <span class="keyword">new</span> <a class="code" href="osm2graph_8cpp.html#ac67c257267e24e52a63e063afa220484">Nodes_t</a>(2);</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a> = <span class="keyword">new</span> <a class="code" href="osm2graph_8cpp.html#a1192e0b3b6e0a1997dc2a3e21be39ab4">Vertices_t</a>(3);</div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a> = <span class="keyword">new</span> <a class="code" href="osm2graph_8cpp.html#a3ea3507aa745cb1c0ff9772a098551d9">Distance_t</a>(4);</div>
<div class="line">    </div>
<div class="line">    <a name="a28"></a><a class="code" href="namespaceCanalTP.html#a0b7163ce303be16ec78861cda0f9f6cd">read_osm_pbf</a>(argv[1], routing, <span class="keyword">true</span>); <span class="comment">// ways</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespaceCanalTP.html#a0b7163ce303be16ec78861cda0f9f6cd">read_osm_pbf</a>(argv[1], routing, <span class="keyword">false</span>); <span class="comment">// nodes und bedingungen</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// create verticies -------------------------------------------------------------------------------------</span></div>
<div class="line">    </div>
<div class="line">    <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Ways_t::Data</a> w;</div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#a0b1f512d3b235baf9b8949152f9d5b89">ways</a>-&gt;<a name="a29"></a><a class="code" href="classSwappyItems.html#ad435934836fba9541979039ec53d3a2c">each</a>(w, [](<a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> wayosmid, <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Ways_t::Data</a> &amp; way) {</div>
<div class="line">        <span class="keywordtype">bool</span> firstItem = <span class="keyword">true</span>;</div>
<div class="line">        <a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> last;</div>
<div class="line">        <span class="keywordtype">double</span> lastLon = 0.0;</div>
<div class="line">        <span class="keywordtype">double</span> lastLat = 0.0;</div>
<div class="line">        <a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> dist = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// create verticies from refs: a-&gt;b-&gt;c-&gt;d-&gt;e</span></div>
<div class="line">        <span class="comment">// d link to e(=last)</span></div>
<div class="line">        <span class="comment">// c link to d(=last)</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i &lt; way.second.size(); ++i) {</div>
<div class="line">            <a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> ref = way.second[way.second.size()-1 - i]; <span class="comment">// add actually ref to the last ref (from backward)</span></div>
<div class="line">            <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Nodes_t::Data</a> * nptr = <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(ref);</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (nptr == <span class="keyword">nullptr</span>) <span class="keywordflow">continue</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (nptr-&gt;first._lon == 0 &amp;&amp; nptr-&gt;first._lat == 0) <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// with reduction of nodes</span></div>
<div class="line">            if (nptr-&gt;first._used == 0) {</div>
<div class="line">                if (firstItem == false) {</div>
<div class="line">                    dist += calcDist(nptr-&gt;first._lon, nptr-&gt;first._lat, lastLon, lastLat);</div>
<div class="line">                    lastLon = nptr-&gt;first._lon;</div>
<div class="line">                    lastLat = nptr-&gt;first._lat;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> * vptr = <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(ref);</div>
<div class="line">            <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Distance_t::Data</a> * dptr = <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(ref);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (vptr == <span class="keyword">nullptr</span>) {</div>
<div class="line">                <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> vertex;</div>
<div class="line">                <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Distance_t::Data</a> distance;</div>
<div class="line">                vertex.first._way = wayosmid;</div>
<div class="line">                vertex.first._lon = nptr-&gt;first._lon;</div>
<div class="line">                vertex.first._lat = nptr-&gt;first._lat;</div>
<div class="line">                <span class="keywordflow">if</span> (firstItem) {</div>
<div class="line">                    firstItem = <span class="keyword">false</span>;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    dist += <a class="code" href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a>(vertex.first._lon, vertex.first._lat, lastLon, lastLat);</div>
<div class="line">                    vertex.second.push_back(last);</div>
<div class="line">                    distance.second.push_back(dist);</div>
<div class="line">                }</div>
<div class="line">                lastLon = nptr-&gt;first._lon;</div>
<div class="line">                lastLat = nptr-&gt;first._lat;</div>
<div class="line">                <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, vertex.first, vertex.second);</div>
<div class="line">                <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, distance.first, distance.second);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (firstItem) {</div>
<div class="line">                    firstItem = <span class="keyword">false</span>;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    dist += <a class="code" href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a>(vptr-&gt;first._lon, vptr-&gt;first._lat, lastLon, lastLat);</div>
<div class="line">                    vptr-&gt;second.push_back(last);</div>
<div class="line">                    dptr-&gt;second.push_back(dist);</div>
<div class="line">                }</div>
<div class="line">                lastLon = nptr-&gt;first._lon;</div>
<div class="line">                lastLat = nptr-&gt;first._lat;</div>
<div class="line">                <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, vptr-&gt;first, vptr-&gt;second);</div>
<div class="line">                <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, dptr-&gt;first, dptr-&gt;second);</div>
<div class="line">            }</div>
<div class="line">            dist = 0;</div>
<div class="line">            last = ref;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Not a oneway. create verticies from refs in the direction: a&lt;-b&lt;-c&lt;-d&lt;-e</span></div>
<div class="line">        <span class="comment">// b link to a(=last)</span></div>
<div class="line">        <span class="comment">// c link to b(=last)</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        firstItem = <span class="keyword">true</span>;</div>
<div class="line">        lastLon = 0.0;</div>
<div class="line">        lastLat = 0.0;</div>
<div class="line">        dist = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (way.first._oneway == <span class="keyword">false</span>) {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i &lt; way.second.size(); ++i) {</div>
<div class="line">                <a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> ref = way.second[i];</div>
<div class="line">                <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Nodes_t::Data</a> * nptr = <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(ref);</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> (nptr == <span class="keyword">nullptr</span>) <span class="keywordflow">continue</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (nptr-&gt;first._lon == 0 &amp;&amp; nptr-&gt;first._lat == 0) <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">                <span class="comment">// with reduction of nodes</span></div>
<div class="line">                <span class="keywordflow">if</span> (nptr-&gt;first._used == 0) {</div>
<div class="line">                    <span class="keywordflow">if</span> (firstItem == <span class="keyword">false</span>) {</div>
<div class="line">                        dist += <a class="code" href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a>(nptr-&gt;first._lon, nptr-&gt;first._lat, lastLon, lastLat);</div>
<div class="line">                        lastLon = nptr-&gt;first._lon;</div>
<div class="line">                        lastLat = nptr-&gt;first._lat;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line">                </div>
<div class="line">                <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> * vptr = <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(ref);</div>
<div class="line">                <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Distance_t::Data</a> * dptr = <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(ref);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (vptr == <span class="keyword">nullptr</span>) {</div>
<div class="line">                    <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> vertex;</div>
<div class="line">                    <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Distance_t::Data</a> distance;</div>
<div class="line">                    vertex.first._way = wayosmid;</div>
<div class="line">                    vertex.first._lon = nptr-&gt;first._lon;</div>
<div class="line">                    vertex.first._lat = nptr-&gt;first._lat;</div>
<div class="line">                    <span class="keywordflow">if</span> (firstItem) {</div>
<div class="line">                        firstItem = <span class="keyword">false</span>;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        dist += <a class="code" href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a>(vertex.first._lon, vertex.first._lat, lastLon, lastLat);</div>
<div class="line">                        vertex.second.push_back(last);</div>
<div class="line">                        distance.second.push_back(dist);</div>
<div class="line">                    }</div>
<div class="line">                    lastLon = nptr-&gt;first._lon;</div>
<div class="line">                    lastLat = nptr-&gt;first._lat;</div>
<div class="line">                    <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, vertex.first, vertex.second);</div>
<div class="line">                    <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, distance.first, distance.second);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keywordflow">if</span> (firstItem) {</div>
<div class="line">                        firstItem = <span class="keyword">false</span>;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        dist += <a class="code" href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a>(vptr-&gt;first._lon, vptr-&gt;first._lat, lastLon, lastLat);</div>
<div class="line">                        vptr-&gt;second.push_back(last);</div>
<div class="line">                        dptr-&gt;second.push_back(dist);</div>
<div class="line">                    }</div>
<div class="line">                    lastLon = nptr-&gt;first._lon;</div>
<div class="line">                    lastLat = nptr-&gt;first._lat;</div>
<div class="line">                    <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, vptr-&gt;first, vptr-&gt;second);</div>
<div class="line">                    <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">set</a>(ref, dptr-&gt;first, dptr-&gt;second);</div>
<div class="line">                }</div>
<div class="line">                dist = 0;</div>
<div class="line">                last = ref;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// all items, no stop</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    });</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// verticies to osm ------------------------------------------------</span></div>
<div class="line">    </div>
<div class="line">    uint64_t wayOsmId = 1;</div>
<div class="line">    FILE * pFile;</div>
<div class="line">    pFile = fopen (<span class="stringliteral">&quot;graph.osm&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    fprintf (pFile, </div>
<div class="line">        <span class="stringliteral">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;osm version=&#39;0.6&#39;&gt;\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;bounds minlat=&#39;%f&#39; minlon=&#39;%f&#39; maxlat=&#39;%f&#39; maxlon=&#39;%f&#39;/&gt;\n&quot;</span>,</div>
<div class="line">        <a class="code" href="osm2graph_8cpp.html#a23d759ebd23b8b9cb9c63eea5cc83583">LAT_BOUND</a>, <a class="code" href="osm2graph_8cpp.html#a55c3677d7a94dbe389e73f4e473c8b79">LON_BOUND</a>,</div>
<div class="line">        <a class="code" href="osm2graph_8cpp.html#a23d759ebd23b8b9cb9c63eea5cc83583">LAT_BOUND</a> + <a class="code" href="osm2graph_8cpp.html#afa99738263e8ba632668e483f87d6f1f">LAT_BOUND_DIF</a>, <a class="code" href="osm2graph_8cpp.html#a55c3677d7a94dbe389e73f4e473c8b79">LON_BOUND</a> + <a class="code" href="osm2graph_8cpp.html#a25693d3ff18682aed1a5d004e1da24ba">LON_BOUND_DIF</a></div>
<div class="line">    );</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> dummy;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// all nodes to the beginning!!!</span></div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#ad435934836fba9541979039ec53d3a2c">each</a>(dummy, [&amp;wayOsmId, &amp;pFile](<a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> <span class="keywordtype">id</span>, <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> &amp; v) {</div>
<div class="line">        <span class="comment">//if (v.second.size() &gt; 0) { // no. it could be a single point, where many oneways result in!</span></div>
<div class="line">        fprintf (pFile, </div>
<div class="line">            <span class="stringliteral">&quot;&lt;node id=&#39;%&quot;</span> PRIu64 <span class="stringliteral">&quot;&#39;&quot;</span> <a name="a30"></a><a class="code" href="osm2graph_8cpp.html#aad3dc8c584de225f8aa7e77801a5199d">DEFAULTATTR</a> <span class="stringliteral">&quot; lat=&#39;%f&#39; lon=&#39;%f&#39;/&gt;\n&quot;</span>,</div>
<div class="line">            <span class="keywordtype">id</span>, v.first._lat, v.first._lon</div>
<div class="line">        );</div>
<div class="line">        <span class="comment">// all items, no stop</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// create the new ways</span></div>
<div class="line">    <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>-&gt;<a class="code" href="classSwappyItems.html#ad435934836fba9541979039ec53d3a2c">each</a>(dummy, [&amp;wayOsmId, &amp;pFile](<a class="code" href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a> <span class="keywordtype">id</span>, <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Vertices_t::Data</a> &amp; v) {</div>
<div class="line">        <a class="code" href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">Distance_t::Data</a> * dptr = <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>-&gt;<a class="code" href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">get</a>(<span class="keywordtype">id</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i &lt; v.second.size(); ++i) {</div>
<div class="line">            fprintf (pFile, </div>
<div class="line">                <span class="stringliteral">&quot;&lt;way id=&#39;%&quot;</span> PRIu64 <span class="stringliteral">&quot;&#39;&quot;</span> <a class="code" href="osm2graph_8cpp.html#aad3dc8c584de225f8aa7e77801a5199d">DEFAULTATTR</a> <span class="stringliteral">&quot;&gt;&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;&lt;nd ref=&#39;%&quot;</span> PRIu64 <span class="stringliteral">&quot;&#39;/&gt;&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;&lt;nd ref=&#39;%&quot;</span> PRIu64 <span class="stringliteral">&quot;&#39;/&gt;&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;&lt;tag k=&#39;highway&#39; v=&#39;secondary&#39;/&gt;&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;&lt;tag k=&#39;oneway&#39; v=&#39;yes&#39;/&gt;&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;&lt;tag k=&#39;name&#39; v=\&quot;%&quot;</span> PRIu64 <span class="stringliteral">&quot;\&quot;/&gt;&lt;/way&gt;\n&quot;</span>,</div>
<div class="line">                wayOsmId,</div>
<div class="line">                <span class="keywordtype">id</span>,</div>
<div class="line">                v.second[i],</div>
<div class="line">                dptr-&gt;second[i]</div>
<div class="line">            );</div>
<div class="line">            ++wayOsmId;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// all items, no stop</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    fprintf (pFile, <span class="stringliteral">&quot;&lt;/osm&gt;\n&quot;</span>);</div>
<div class="line">    fclose (pFile);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">delete</span> <a class="code" href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a>;</div>
<div class="line">    <span class="keyword">delete</span> <a class="code" href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a>;</div>
<div class="line">    <span class="keyword">delete</span> <a class="code" href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a>;</div>
<div class="line">    <span class="keyword">delete</span> <a class="code" href="osm2graph_8cpp.html#a0b1f512d3b235baf9b8949152f9d5b89">ways</a>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="aSwappyItems_8hpp_html"><div class="ttname"><a href="SwappyItems_8hpp.html">SwappyItems.hpp</a></div></div>
<div class="ttc" id="aclassSwappyItems_html"><div class="ttname"><a href="classSwappyItems.html">SwappyItems</a></div><div class="ttdef"><b>Definition:</b> SwappyItems.hpp:49</div></div>
<div class="ttc" id="aclassSwappyItems_html_a8014ff3b0bf09f36b56ddf4d31960180"><div class="ttname"><a href="classSwappyItems.html#a8014ff3b0bf09f36b56ddf4d31960180">SwappyItems::Data</a></div><div class="ttdeci">std::pair&lt; TVALUE, std::vector&lt; TKEY &gt; &gt; Data</div><div class="ttdef"><b>Definition:</b> SwappyItems.hpp:52</div></div>
<div class="ttc" id="aclassSwappyItems_html_ab76f2bf942b66c83213a1865e7260385"><div class="ttname"><a href="classSwappyItems.html#ab76f2bf942b66c83213a1865e7260385">SwappyItems::get</a></div><div class="ttdeci">Data * get(const TKEY &amp;key)</div><div class="ttdef"><b>Definition:</b> SwappyItems.hpp:188</div></div>
<div class="ttc" id="aclassSwappyItems_html_ad435934836fba9541979039ec53d3a2c"><div class="ttname"><a href="classSwappyItems.html#ad435934836fba9541979039ec53d3a2c">SwappyItems::each</a></div><div class="ttdeci">bool each(Data &amp;back, std::function&lt; bool(TKEY, Data &amp;)&gt; foo)</div><div class="ttdef"><b>Definition:</b> SwappyItems.hpp:790</div></div>
<div class="ttc" id="aclassSwappyItems_html_af5a792fbb62a2e872a45e46cf072593c"><div class="ttname"><a href="classSwappyItems.html#af5a792fbb62a2e872a45e46cf072593c">SwappyItems::set</a></div><div class="ttdeci">bool set(TKEY key, TVALUE value)</div><div class="ttdef"><b>Definition:</b> SwappyItems.hpp:123</div></div>
<div class="ttc" id="anamespaceCanalTP_html"><div class="ttname"><a href="namespaceCanalTP.html">CanalTP</a></div><div class="ttdef"><b>Definition:</b> osmpbfreader.hpp:48</div></div>
<div class="ttc" id="anamespaceCanalTP_html_a090d83d412eb66517a72e002e0c583a6"><div class="ttname"><a href="namespaceCanalTP.html#a090d83d412eb66517a72e002e0c583a6">CanalTP::References</a></div><div class="ttdeci">std::vector&lt; Reference &gt; References</div><div class="ttdef"><b>Definition:</b> osmpbfreader.hpp:65</div></div>
<div class="ttc" id="anamespaceCanalTP_html_a0b7163ce303be16ec78861cda0f9f6cd"><div class="ttname"><a href="namespaceCanalTP.html#a0b7163ce303be16ec78861cda0f9f6cd">CanalTP::read_osm_pbf</a></div><div class="ttdeci">void read_osm_pbf(const std::string &amp;filename, Visitor &amp;visitor, bool wayOnly)</div><div class="ttdef"><b>Definition:</b> osmpbfreader.hpp:359</div></div>
<div class="ttc" id="anamespaceCanalTP_html_a4f01523a1c3b0897ec8e357a68513217"><div class="ttname"><a href="namespaceCanalTP.html#a4f01523a1c3b0897ec8e357a68513217">CanalTP::Tags</a></div><div class="ttdeci">std::map&lt; std::string, std::string &gt; Tags</div><div class="ttdef"><b>Definition:</b> osmpbfreader.hpp:51</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a05f14885b17fed9d9c6274891dde9bee"><div class="ttname"><a href="osm2graph_8cpp.html#a05f14885b17fed9d9c6274891dde9bee">Key</a></div><div class="ttdeci">uint64_t Key</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:48</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a0b1f512d3b235baf9b8949152f9d5b89"><div class="ttname"><a href="osm2graph_8cpp.html#a0b1f512d3b235baf9b8949152f9d5b89">ways</a></div><div class="ttdeci">Ways_t * ways</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:84</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a1192e0b3b6e0a1997dc2a3e21be39ab4"><div class="ttname"><a href="osm2graph_8cpp.html#a1192e0b3b6e0a1997dc2a3e21be39ab4">Vertices_t</a></div><div class="ttdeci">SwappyItems&lt; Key, Vertex, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK &gt; Vertices_t</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:88</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a23d759ebd23b8b9cb9c63eea5cc83583"><div class="ttname"><a href="osm2graph_8cpp.html#a23d759ebd23b8b9cb9c63eea5cc83583">LAT_BOUND</a></div><div class="ttdeci">#define LAT_BOUND</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:32</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a2410a433659c2a453790dea3033603ff"><div class="ttname"><a href="osm2graph_8cpp.html#a2410a433659c2a453790dea3033603ff">TORADI</a></div><div class="ttdeci">#define TORADI(angleDegrees)</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:19</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a25693d3ff18682aed1a5d004e1da24ba"><div class="ttname"><a href="osm2graph_8cpp.html#a25693d3ff18682aed1a5d004e1da24ba">LON_BOUND_DIF</a></div><div class="ttdeci">#define LON_BOUND_DIF</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:31</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="osm2graph_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:220</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a3ea3507aa745cb1c0ff9772a098551d9"><div class="ttname"><a href="osm2graph_8cpp.html#a3ea3507aa745cb1c0ff9772a098551d9">Distance_t</a></div><div class="ttdeci">SwappyItems&lt; Key, Distance, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK &gt; Distance_t</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:90</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a55c3677d7a94dbe389e73f4e473c8b79"><div class="ttname"><a href="osm2graph_8cpp.html#a55c3677d7a94dbe389e73f4e473c8b79">LON_BOUND</a></div><div class="ttdeci">#define LON_BOUND</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:30</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a65edcf08ce03e2cd92d88fcb97c789e1"><div class="ttname"><a href="osm2graph_8cpp.html#a65edcf08ce03e2cd92d88fcb97c789e1">relevance</a></div><div class="ttdeci">int relevance(const std::string &amp;wt)</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:103</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_a9c262dd362043bb970f05a87a0d749fa"><div class="ttname"><a href="osm2graph_8cpp.html#a9c262dd362043bb970f05a87a0d749fa">Ways_t</a></div><div class="ttdeci">SwappyItems&lt; Key, WayData, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK &gt; Ways_t</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:82</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_aad16ed4c4050b590aac7aa8151f06161"><div class="ttname"><a href="osm2graph_8cpp.html#aad16ed4c4050b590aac7aa8151f06161">nodes</a></div><div class="ttdeci">Nodes_t * nodes</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:85</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_aad3dc8c584de225f8aa7e77801a5199d"><div class="ttname"><a href="osm2graph_8cpp.html#aad3dc8c584de225f8aa7e77801a5199d">DEFAULTATTR</a></div><div class="ttdeci">#define DEFAULTATTR</div><div class="ttdoc">build a map file with osmosis: ../osmosis/bin/osmosis read-xml file=graph.osm mw file=krefeld_mg....</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:45</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_abd322f3b4e0cc6116c3e5228c08c1d9a"><div class="ttname"><a href="osm2graph_8cpp.html#abd322f3b4e0cc6116c3e5228c08c1d9a">distances</a></div><div class="ttdeci">Distance_t * distances</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:91</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_ac67c257267e24e52a63e063afa220484"><div class="ttname"><a href="osm2graph_8cpp.html#ac67c257267e24e52a63e063afa220484">Nodes_t</a></div><div class="ttdeci">SwappyItems&lt; Key, NodeData, FILE_ITEMS, FILE_MULTI, RAM_MULTI, BBITS, BMASK &gt; Nodes_t</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:83</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_ad953d73a32d9b38d7fe3b647be3eb680"><div class="ttname"><a href="osm2graph_8cpp.html#ad953d73a32d9b38d7fe3b647be3eb680">calcDist</a></div><div class="ttdeci">Key calcDist(double lon1, double lat1, double lon2, double lat2)</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:97</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_aea2ab29d70a81d1a873a2fd41f428296"><div class="ttname"><a href="osm2graph_8cpp.html#aea2ab29d70a81d1a873a2fd41f428296">verticies</a></div><div class="ttdeci">Vertices_t * verticies</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:89</div></div>
<div class="ttc" id="aosm2graph_8cpp_html_afa99738263e8ba632668e483f87d6f1f"><div class="ttname"><a href="osm2graph_8cpp.html#afa99738263e8ba632668e483f87d6f1f">LAT_BOUND_DIF</a></div><div class="ttdeci">#define LAT_BOUND_DIF</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:33</div></div>
<div class="ttc" id="aosmpbfreader_8hpp_html"><div class="ttname"><a href="osmpbfreader_8hpp.html">osmpbfreader.hpp</a></div></div>
<div class="ttc" id="astructDistance_html"><div class="ttname"><a href="structDistance.html">Distance</a></div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:77</div></div>
<div class="ttc" id="astructNodeData_html"><div class="ttname"><a href="structNodeData.html">NodeData</a></div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:53</div></div>
<div class="ttc" id="astructRouting_html"><div class="ttname"><a href="structRouting.html">Routing</a></div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:120</div></div>
<div class="ttc" id="astructVertex_html"><div class="ttname"><a href="structVertex.html">Vertex</a></div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:69</div></div>
<div class="ttc" id="astructWayData_html"><div class="ttname"><a href="structWayData.html">WayData</a></div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:60</div></div>
<div class="ttc" id="astructWayData_html_ae5ee62c1bbb934ecfa4932caf567cc55"><div class="ttname"><a href="structWayData.html#ae5ee62c1bbb934ecfa4932caf567cc55">WayData::_oneway</a></div><div class="ttdeci">bool _oneway</div><div class="ttdef"><b>Definition:</b> osm2graph.cpp:61</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
